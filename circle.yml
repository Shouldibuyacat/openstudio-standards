machine:
  services:
    - docker

dependencies:
  override:

test:
  override:
    - echo coveralls_parallel equals $COVERALLS_PARALLEL:
        parallel: true
    - mkdir -p $CIRCLE_TEST_REPORTS/minitest:
        parallel: true
    - mkdir -p test/reports:
        parallel: true
    - docker run -e CIRCLE_NODE_TOTAL -e CIRCLE_NODE_INDEX -e COVERALLS_PARALLEL -v $(pwd):/openstudio-standards nrel/openstudio /openstudio-standards/openstudio-standards/test/bin/docker-run.sh:
        parallel: true
        timeout: 7200
    - ls $CIRCLE_TEST_REPORTS/minitest:
        parallel: true        
    - rsync -av test/reports/ $CIRCLE_TEST_REPORTS/minitest/:
        parallel: true
    - ls $CIRCLE_TEST_REPORTS/minitest:
        parallel: true
    - bundle exec rake coveralls:push

general:
  artifacts:
    - "openstudio-standards/test/output/prototype_buildings_results.csv"
    - "openstudio-standards/test/output/prototype_buildings_run.log"
    
notify:
  webhooks:
    - url: https://coveralls.io/webhook?repo_token=eSSTEMIukghhVxNNkJ7Wp3pWDzgGQhowV
    - url: http://requestb.in/yye4r0yy
    - url: http://mockbin.org/bin/e8310461-bbed-42c2-907c-b4a3c5db415e?foo=bar&foo=baz
